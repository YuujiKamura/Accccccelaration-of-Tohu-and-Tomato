# 移動テスト仕様書

## 概要

このドキュメントでは、プレイヤーの移動に関するテスト仕様と、テスト結果のレポート機能について説明します。

## テスト基盤

### BaseTestCase

`tests/helpers/test_base.py` に実装された `BaseTestCase` クラスは、unittest.TestCase を拡張し、テスト結果の詳細な記録とレポート生成機能を提供します。

#### 主な機能

- テスト実行時間の計測
- カテゴリ別・クラス別のテスト結果集計
- 詳細なテストレポートの生成（JSONファイル出力とコンソール表示）

#### 使用方法

```python
from tests.helpers.test_base import BaseTestCase

class YourTestCase(BaseTestCase):
    def test_something(self):
        """テストの説明"""
        # テストコード
        self.assertTrue(True)

# レポート生成
YourTestCase.generate_report('report.json')
```

## テスト実装

### 基本移動テスト

`tests/unit/test_player_movement.py` では、以下の基本的な移動をテストしています：

- 静止状態（何も押さない）
- 単純な方向移動（上下左右）
- 斜め移動の正規化
- ダッシュ機能（開始、クールダウン、ヒート制限）
- 画面境界判定
- 移動の慣性（加速と減速）

### 高度な移動テスト

`tests/unit/test_advanced_movement.py` では、より高度な移動をテストしています：

- 8方向移動の全パターン（上下左右と4つの斜め方向）
- ダッシュ中のカーブ移動
- ダッシュ中の方向転換

### テスト実行スクリプト

- `tests/run_movement_tests.py`: 基本移動テストの実行
- `tests/run_advanced_tests.py`: 高度な移動テストの実行とレポート生成

## 現在の実装の動作特性

### 8方向移動

プレイヤーは上下左右および4つの斜め方向（右上、右下、左上、左下）の計8方向に移動できます。斜め移動時には、速度ベクトルが正規化され、斜めに移動しても直線移動と同じ速度になります。

### ダッシュ機能

- **即時発動**: Shiftキーを押すと即座にダッシュが発動します
- **方向固定**: ダッシュ開始時の方向が維持されます（カーブするダッシュではありません）
- **ヒート制限**: ダッシュ中はヒートゲージが上昇し、最大値に達するとダッシュが終了します
- **クールダウン**: ダッシュ終了後は一定時間、再度ダッシュできません

## テスト結果とレポート

テスト実行後、`tests/reports/` ディレクトリに詳細なテスト結果がJSON形式で保存されます。このレポートには以下の情報が含まれます：

- 実行時間
- 全テスト数、成功数、失敗数、パス率
- カテゴリ別テスト結果
- クラス別テスト結果
- 失敗したテストの詳細（エラーメッセージなど）

## 今後の改善案

1. **カーブダッシュの実装**:
   現在のダッシュは方向固定ですが、ダッシュ中に方向を変更できる「カーブダッシュ」を実装することでゲームプレイの柔軟性が向上します。

2. **テスト拡張**:
   - 慣性とグリップの詳細なテスト
   - 障害物との衝突時の挙動テスト
   - 異なる地形での移動特性のテスト

3. **テストレポートの視覚化**:
   - テスト結果をグラフィカルに表示するHTMLレポート
   - テスト実行の時系列トレンド表示

## テストの実行方法

```bash
# 基本移動テストの実行
python -m tests.run_movement_tests

# 高度な移動テストの実行
python -m tests.run_advanced_tests
``` 